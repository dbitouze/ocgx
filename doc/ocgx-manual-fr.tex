\documentclass[a4paper]{ltxdoc}
\usepackage[vmargin=2cm,hmargin=3.5cm]{geometry}
\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{microtype}
\usepackage{xcolor}
\usepackage{ifthen}
\usepackage{doc}
\usepackage{fancyvrb}
\usepackage{newverbs}
\usepackage{listings}
\lstdefinestyle{TeXcode}{
  fancyvrb=true,
  language=[LaTeX]TeX,
  basicstyle=\ttfamily,
  keywordstyle=\color{blue}\bfseries,
  commentstyle=\color{red!50!black}\itshape,
  stringstyle=\ttfamily\color{green!50!black},
  showspaces=false,
  showstringspaces=false,
  backgroundcolor=\color{white},
  fontadjust=true,
  aboveskip=1ex,
  belowskip=1ex,
  emphstyle=\color{red},
  keepspaces=true,
  flexiblecolumns=true
}
\newenvironment{prog}[1]{\vspace{1ex}--- \texttt{\emph{#1}} ---}{}
\newcommand{\TeXexample}[3][]{
  \ifthenelse{\equal{#1}{}}{\begin{prog}{#2}}{\begin{prog}{#2 (#1)}}
  \lstinputlisting[style=TeXcode,aboveskip=0ex,#3]{#2}
  \end{prog}
}
  
\usepackage{url}
\usepackage{hyperref}
\usepackage[french]{babel}
\usepackage{parskip}

\newcounter{mynotes}
\newenvironment{note}{\textbf{Note \stepcounter{mynotes}\arabic{mynotes} :} }{}

\newverbcommand\code{\color{red}}{}
\newverbcommand\style{\hspace{-2em}\color{red}}{}
\newcommand\argument[1]{\textcolor{black}{\ttfamily #1}}
\newcommand\TikZ{Ti\emph{k}Z}

\title{Documentation du package \texttt{ocgx.sty}}
\author{%
  Paul Isambert\\\url{zappathustra@free.fr}%
  \and%
  Paul Gaborit\\\url{paul.gaborit@gmail.com}}
\date{\today}

\begin{document}
\maketitle


Le package \code+ocgx+ étend et documente le package \code+ocg+ (qui
vient avec Asymptote) qui permet de créer des OCG (\emph{Optional
  Content Group}) dans les documents PDF.

Chaque OCG regroupe du contenu \TeX{} dans une couche du fichier
PDF. Chacune de ces couches peut être afficher ou non. Des liens
permettent d'activer ou de désactiver l'affichage des OCG.

L'intérêt du package \code+ocgx+ est de ne pas utiliser de code
Javascript embarqué dans le document PDF pour activer ou désactiver les
OCG. Il est donc utilisable avec de plusieurs outils de visualisation
PDF (à ce jour, nous avons pu tester avec succès \emph{Acrobat Reader},
\emph{Foxit Reader} et \emph{evince}).

\section{Utilisation}

Voici un exemple simple.

\TeXexample{ocgx-example-1.tex}{}

Ce document crée un OCG nommé \emph{ocg1} contenant le texte \og
\emph{first example.} \fg{} qui est visible par défaut. Vous pouvez
afficher ou cacher cet OCG en cliquant sur le lien \og \emph{Button.}
\fg{}.

\subsection{La création des OCG}

\DescribeEnv{ocg}%
L'environnement \code+ocg+ (fourni par le package \code+ocg+) requiert
trois arguments. Le premier argument est le nom de l'OCG tel qu'il
apparaîtra dans le viewer PDF. Le second est le nom interne utilisé pour
référencer cet OCG. Le troisième est un flag qui indique si l'OCG doit
être visible ou non (1 pour oui, 0 pour non).  Le contenu de
l'environnement est tout le matériel \TeX{} à placer dans cet OCG.

Le code suivant crée un OCG nommé \emph{Nom OCG} ayant comme référence
interne \emph{refocg} et avec comme contenu le texte \emph{contenu de
  l'ocg}. Ce groupe sera visible (le troisième argument est 1).

\begin{lstlisting}[style=TeXcode]
  \begin{ocg}{Nom OCG}{refocg}{1}
    contenu de l'ocg
  \end{ocg}
\end{lstlisting}

\begin{note}
  la référence d'un OCG est constituée de lettres (A-Z, a-z), de
  chiffres (0-9) et éventuellement du caractère \code+@+.
\end{note}

\begin{note}
  le contenu d'un OCG ne doit pas s'étendre sur plusieurs
  pages. Actuellement, rien n'empêche de le faire mais le résultat
  obtenu ne sera certainement pas celui que vous attendez !
\end{note}

\begin{note}
  il est possible d'imbriquer un OCG dans un autre OCG. Pour que l'OCG
  interne soit réllement visible, il faut qu'il soit dans l'état visible
  et que l'OCG englobant le soit aussi.
\end{note}

\begin{note}
  on peut réutiliser plusieurs fois la même référence pour regrouper de
  nombreux éléments (pas nécessairement dans la même page) dans un seul
  OCG. Seul le premier nom fourni sera utilisé.
\end{note}

\begin{note}
  Le package \code+ocg+ écrit par Michael Ritzert n'a pas réellement de
  documentation. À ma connaissance, la seule \og \emph{documentation}
  \fg{} de ce package est proposée sur le weblog du site TeXample.net :
  \url{http://www.texample.net/weblog/2008/nov/02/creating-pdf-layers/}.
\end{note}

\subsection{La gestion de la visibilité des OCG}

\begin{note}
  les liens créés par toutes ces macros sont placés dans une
  \code+\hbox+. Ils ne peuvent pas donc s'étendre sur plusieurs lignes.
\end{note}

\DescribeMacro{\switchOCG}%
La macro \code+\switchOCG+ transforme son second argument en un lien
cliquable qui basculera l'état de visibilité de tous les OCG listés (par
leur référence) dans son premier argument : si un OCG était visible, il
deviendra invisible et, inversement, si un OCG était invisible, il
deviendra visible.

Le code suivant crée le lien \emph{bascule} qui basculera l'état des OCG
dont les références sont \emph{ocg1} et \emph{ocg2} :

\begin{lstlisting}[style=TeXcode]
  \switchOCG{ocg1 ocg2}{bascule}
\end{lstlisting}

\DescribeMacro{\showOCG}%
La macro \code+\showOCG+ transforme son second argument en un lien
cliquable qui rendra visibles tous les OCG dont les références sont
listées dans son premier argument : un OCG invisible deviendra visible
et un OCG déjà visible le restera.

Le code suivant crée le lien \emph{voir} qui rendra visibles les OCG
nommés \emph{ocg1} et \emph{ocg2} :
\begin{lstlisting}[style=TeXcode]
  \showOCG{ocg1 ocg2}{voir}
\end{lstlisting}

\DescribeMacro{\hideOCG}%
La macro \code+\hideOCG+ transforme son second argument en un lien
cliquable qui rendra invisibles tous les OCG dont les références sont
listées dans son premier argument : un OCG visible deviendra invisible
et un OCG déjà invisible le restera.

Le code suivant crée le lien \emph{cacher} qui rendra invisibles les OCG
nommés \emph{ocg1} et \emph{ocg2} :
\begin{lstlisting}[style=TeXcode]
  \hideOCG{ocg1 ocg2}{cacher}
\end{lstlisting}

\DescribeMacro{\actionsOCG}%
La macro \code+\actionsOCG+ transforme son quatrième argument en un lien
cliquable. Les trois premiers arguments sont des listes de références
d'OCG. La première liste contient les références des OCG dont il faut
basculer l'état de visibilité. La seconde liste contient les références
des OCG qu'il faudra rendre visibles et la troisième liste contient les
références des OCG qu'il faudra rendre invisibles.

Le code suivant crée le lien \emph{actions} qui basculera l'état de
visibilité de l'OCG nommé \emph{ocg1}, qui rendra visible l'OCG nommé
\emph{ocg3} et qui rendre invisible l'OCG nommé \emph{ocg2} :
\begin{lstlisting}[style=TeXcode]
  \actionsOCG{ocg1}{ocg3}{ocg2}{actions}
\end{lstlisting}

\section{Usage combiné avec \TikZ{}}

Vous pouvez utilisez le package \code+ocgx+ avec \TikZ{}. Le package
\code+ocgx+ fournit une bibliothèque \TikZ{} proposant cinq styles
spécifiques pour transformer un chemin (\code+\path+ ou \code+\node+) en
lien cliquable. Pour cela, il vous suffit d'ajouter les lignes suivantes
dans votre préambule:
\begin{lstlisting}[style=TeXcode]
  \usepackage{tikz}
  \usetikzlibrary{ocgx}
\end{lstlisting}

\begin{list}{}
\item
\noindent\style+/tikz/switch OCG+\argument{=\{\emph{<liste d'OCG>}\}}

Ce style transforme le chemin ou le n\oe{}ud courant en un lien
fonctionnant comme celui de la macro \code+\switchOCG+ (l'état de
visibilité des OCG référencés est inversé).

\noindent\style+/tikz/show OCG+\argument{=\{\emph{<liste d'OCG>}\}}

Ce style transforme le chemin ou le n\oe{}ud courant en un lien
fonctionnant comme celui de la macro \code+\showOCG+ (les OCG référencés
sont rendus visibles).

\noindent\style+/tikz/hide OCG+\argument{=\{\emph{<liste d'OCG>}\}}

Ce style transforme le chemin ou le n\oe{}ud courant en un lien
fonctionnant comme celui de la macro \code+\hideOCG+ (les OCG référencés
sont rendus invisibles).

\noindent\style+/tikz/actions OCG+\argument{=\{\emph{<liste d'OCG>}\}\{\emph{<liste d'OCG>}\}\{\emph{<liste d'OCG>}\}}

Ce style transforme le chemin ou le n\oe{}ud courant en un lien
fonctionnant comme celui de la macro \code+\actionsOCG+ (l'état de
visibilité des OCG de la première liste est inversé, les OCG de la
seconde liste sont rendus visibles et ceux de la troisième liste sont
rendus invisibles).

\noindent\style+/tikz/switch OCG with mark+\argument{=\{\emph{<basename>}\}\{\emph{<liste d'OCG>}\}}

Ce style transforme le chemin ou le n\oe{}ud courant en un lien
fonctionnant comme celui de la macro \code+\switchOCG+ (l'état de
visibilité des OCG listés est inversé).

Une marque (actuellement une simple croix) est dessinée par dessus le
chemin ou le noeud courant dans un OCG dont la référence est
\code+checkbox@<basename>+. La visibilité de ce nouvel OCG sera inversé
en même temps que ceux de toute la liste.
\end{list}

\begin{note}
  Quelle que soit la forme du chemin ou du n\oe{}ud courant, c'est sa
  \emph{bounding box} qui est utilisée pour fabriquer le lien (le lien
  est donc toujours rectangulaire et horizontal).
\end{note}

\section{Exemple}

Le document \code+demo-ocgx.tex+ propose plusieurs exemples
d'utilisation du package \code+ocgx+ avec \TikZ{}.

\section{Limitations et bugs}

Voici quelques-unes des limitations et des bugs de la version actuelle:
\begin{enumerate}
\item Les liens sont toujours des rectangles \emph{horizontaux}!
\item Les OCG qui s'étendent sur plusieurs pages ne sont pas détectés
  mais ne fonctionnent pas correctement.
\item La liste des OCG créés par \code+ocg+ est vue par les
  visualisateurs PDF comme une liste à plat. Leur éventuelle hiérarchie
  n'est pas affichée.
\item Un OCG doit être créé \emph{avant} son utilisation dans un lien.
\item Le contenu d'un OCG ne peut pas être créé en plusieurs fois.
\item Si un même nom est utilisé pour plusieurs OCG, seul le dernier
  fonctionne mais aucun message n'est affiché.
\item La documentation n'existe qu'en français.
\item La documentation ne montre pas d'exemple avec Plain-\TeX{}.
\item Le package n'est pas encore disponible sur CTAN.
\end{enumerate}

\section{Distribution}

Ce package est encore expérimental. Il n'est pas encore diffusé sur
CTAN. Vous pouvez le récupérer sur
\url{https://github.com/polgab/ocgx}. Toute aide pour participer à son
développement est la bienvenue. N'hésitez pas à contacter les auteurs.

\end{document}



%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 
